#############################
#### GENERAL AUTOMATIONS ####
#############################

## Purge Recorder DB history daily
- id: ha_purge_recorder
  alias: HA Purge Recorder
  trigger:
    - platform: time
      at: '04:00:00'
#    - platform: time
#      at: '16:00:00'
  action:
    service: recorder.purge
    data:
      keep_days: 3

## Tell me when Home Assistant starts/restarts
- id: ha_notification_startup
  alias: HA Notification Startup
  trigger:
    - platform: homeassistant
      # Event can also be 'shutdown'
      event: start
  action:
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'Home Assistant Started!'
        message: "Home Assistant started and available!"

## Tell me when Home Assistant Stopping/Shutdown
- id: ha_notification_shutdown
  alias: HA Notification Shutdown
  trigger:
    - platform: homeassistant
      event: shutdown
  action:
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'Home Assistant Stopping!'
        message: "Home Assistant shutting down!"

## Tell me when Home Assistant update available
- id: ha_notification_available
  alias: HA Notification Update Available
  trigger:
    - platform: state
      entity_id: updater.updater
  action:
    - service: notify.pushbullet
      data: 
        #target: 'YOUR_TARGET_HERE' #See Pushbullet component for usage
        target: !secret email_target_pushbullet
        title: 'New Home Assistant Release'
        message: "Home Assistant  {{ states.updater.updater.state }}  is now available."

## Tell me when new devices detected on network
- id: ha_notification_new_nmap_device
  alias: HA Notification New NMAP Device
  trigger:
    - platform: event
      event_type: device_tracker_new_device
  action:
    - service: notify.pushbullet
      data:
        target: !secret email_target_pushbullet
        title: 'New Device detected!'
        message: "New unknown NMAP device detected!"
#        message: "New unknown NMAP device detected! > {{ states.updater.updater.state }}"

## Tell me there is an intruder ## entrance
- id: ha_notification_there_is_an_intruder_entrance
  alias: HA Notification There is an intruder ENTRANCE
  trigger:
    - platform: state
      entity_id: !secret coolcam_motion_sensor_1
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_select.house_presence
      state: 'Nobody Home'
  action:
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'ALERT! Movement at Home!'
        message: "Movement has been detected at ENTRANCE!"

## Tell me there is an intruder ## downstairs
- id: ha_notification_there_is_an_intruder_downstairs
  alias: HA Notification There is an intruder DOWNSTAIRS
  trigger:
    - platform: state
      entity_id: !secret coolcam_motion_sensor_2
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_select.house_presence
      state: 'Nobody Home'
  action:
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'ALERT! Movement at Home!'
        message: "Movement has been detected DOWNSTAIRS!"

## Tell me there is an intruder ## upstairs
- id: ha_notification_there_is_an_intruder_upstairs
  alias: HA Notification There is an intruder UPSTAIRS
  trigger:
    - platform: state
      entity_id: !secret 6in1_sensor_move_1
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_select.house_presence
      state: 'Nobody Home'
  action:
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'ALERT! Movement at Home!'
        message: "Movement has been detected UPSTAIRS!"

## Tell me there is an intruder ## living room
- id: ha_notification_there_is_an_intruder_livingroom
  alias: HA Notification There is an intruder LIVINGROOM
  trigger:
    - platform: state
      entity_id: !secret 6in1_sensor_move_2
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_select.house_presence
      state: 'Nobody Home'
  action:
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'ALERT! Movement at Home!'
        message: "Movement has been detected at LIVINGROOM!"

## Pi Door Strike reset after 4 seconds
- id: pi_door_strike
  alias: Pi Door Strike reset
  trigger:
    - platform: state
      entity_id: switch.pi_door_strike
      to: 'on'
      for:
        seconds: 4
  action:
    - service: homeassistant.turn_off
      entity_id:
        - switch.pi_door_strike
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'Door Strike deactivated!'
        message: "Door Strike deactivated!"

## Ziggo Router reset after 5 seconds
- id: ziggo_router_reset
  alias: Ziggo Router Reset
  trigger:
    - platform: state
      entity_id: !secret plug_4
      to: 'off'
      for:
        seconds: 5
  action:
    - service: homeassistant.turn_on
      entity_id:
        - !secret plug_4

## Tell me there is an emergency
#tbc

##########################
### MANUAL AUTOMATIONS ###
##########################

## Turn on bedroom things with button
- id: sw1_bedroom_things
  alias: sw1 Bedroom Things
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d000186dbec
        click_type: single
  action:
    - service: homeassistant.toggle
      entity_id: group.bedroom_things

## Toggle nightlight with button double-click
- id: sw1_gateway_nightlight
  alias: sw1 Gateway Nightlight
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d000186dbec
        click_type: double
  action:
    - service: homeassistant.toggle
      entity_id: !secret light_xiaomi_gateway

## Turn off all lights on long press
- id: sw1_lights_out
  alias: sw1 Lights Out
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d000186dbec
        click_type: long_click_press
  action:
    - service: homeassistant.turn_off
      entity_id:
      - !secret light_upstairs
      - !secret light_downstairs
      - !secret light_entrance
      - !secret light_closet
      - !secret light_spots_1
      - !secret light_table_1
      - !secret light_bedroom_1
      - !secret light_bedroom_2
      - !secret light_gameroom_1
      - !secret light_gameroom_2
    - service: light.turn_on
      data:
        entity_id: !secret light_xiaomi_gateway
        brightness: 40
        transition: 2
        color_name: red
    # - service: homeassistant.turn_on
    #   entity_id:
    #   - !secret light_xiaomi_gateway
    # - service: notify.pushbullet
    #   data: 
    #     target: !secret email_target_pushbullet
    #     title: 'Lights out!'
    #     message: "All lights off!"

## Lock doors
- id: sw2_lock_doors
  alias: sw2 lock doors
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d00018726b8
        click_type: single
  action:
      ## placeholder notification
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'Doors locked!'
        message: "Doors locked!"

## Disarm Alarm system
- id: sw2_disarm_alarm_system
  alias: sw2 Disarm Alarm System
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d00018726b8
        click_type: double
  action:
      ## placeholder notification
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'Alarm Disarmed!'
        message: "Alarm switch disarmed!"

## Open door strike long press
- id: sw2_door_strike
  alias: sw2 Door Strike
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d00018726b8
        click_type: long_click_press
  action:
    - service: homeassistant.toggle
      entity_id:
        - switch.pi_door_strike
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'Door strike activated!'
        message: "Door Strike activated!"

## Activate OPTIMUS single click
- id: sw3_activate_optimus
  alias: sw3 Activate OPTIMUS
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d0001870a09
        click_type: single
  action:
      ## Turn on Triple Monitors
    - service: homeassistant.turn_on
      entity_id: !secret plug_1
      ## wait x seconds
    - delay: 00:00:05
      ## Turn on OPTIMUS
    - service: homeassistant.turn_on
      entity_id: switch.computer_optimus

## Turn off OPTIMUS double click
- id: sw3_deactivate_optimus
  alias: sw3 Deactivate OPTIMUS
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d0001870a09
        click_type: double
  action:
      ## Turn off OPTIMUS
    - service: homeassistant.turn_off
      entity_id: switch.computer_optimus
      ## wait x seconds
    - delay: 00:00:05
      ## Turn off Triple Monitors
    - service: homeassistant.turn_off
      entity_id: !secret plug_1

## Turn on Livingroom things with button
- id: sw4_livingroom_things
  alias: sw4 Livingroom Things
  trigger:
    - platform: event
      event_type: click
      event_data:
        entity_id: binary_sensor.switch_158d0001870ad7
        click_type: single
  action:
    - service: homeassistant.toggle
      entity_id: group.livingroom_things

########################
#### HOUSE PRESENCE ####
########################

## Turn on light when movement upstairs at night
- id: turn_on_lights_when_there_is_movement_upstairs_at_night
  alias: Turn on lights when there is movement upstairs at night
  trigger:
    - platform: state
      entity_id: !secret 6in1_sensor_move_1
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '01:30:00'
      before: '17:00:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_select.house_presence
        state: 'Home'
      - condition: state
        entity_id: input_select.house_presence
        state: 'Lady and The Tramp'
      - condition: state
        entity_id: input_select.house_presence
        state: 'lady ALONE'
  action:
    service: homeassistant.turn_on
    entity_id: script.timed_lamp_upstairs_night

## Turn on light when movement upstairs
- id: turn_on_lights_when_there_is_movement_upstairs
  alias: Turn on lights when there is movement upstairs
  trigger:
    - platform: state
      entity_id: !secret 6in1_sensor_move_1
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '17:00:00'
      before: '01:30:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_select.house_presence
        state: 'Home'
      - condition: state
        entity_id: input_select.house_presence
        state: 'Lady and The Tramp'
      - condition: state
        entity_id: input_select.house_presence
        state: 'lady ALONE'
  action:
    service: homeassistant.turn_on
    entity_id: script.timed_lamp_upstairs

## Turn on light when movement downstairs
- id: turn_on_lights_when_there_is_movement_downstairs
  alias: Turn on lights when there is movement downstairs
  trigger:
    - platform: state
      entity_id: !secret coolcam_motion_sensor_2
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_select.house_presence
        state: 'Home'
      - condition: state
        entity_id: input_select.house_presence
        state: 'Lady and The Tramp'
      - condition: state
        entity_id: input_select.house_presence
        state: 'lady ALONE'
  action:
    service: homeassistant.turn_on
    entity_id: script.timed_lamp_downstairs

## Turn on light when movement Entrance
- id: turn_on_lights_when_there_is_movement_entrance
  alias: Turn on lights when there is movement Entrance
  trigger:
    - platform: state
      entity_id: !secret coolcam_motion_sensor_1
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
#    - condition: state
#      entity_id: sun.sun
#      state: 'below_horizon'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_select.house_presence
        state: 'Home'
      - condition: state
        entity_id: input_select.house_presence
        state: 'Lady and The Tramp'
      - condition: state
        entity_id: input_select.house_presence
        state: 'lady ALONE'
  action:
    service: homeassistant.turn_on
    entity_id: script.timed_lamp_entrance

## Turn on light when movement closet at night
- id: turn_on_lights_when_there_is_movement_closet_at_night
  alias: Turn on lights when there is movement closet at night
  trigger:
    - platform: state
      entity_id: !secret coolcam_motion_sensor_5
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '01:30:00'
      before: '17:00:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_select.house_presence
        state: 'Home'
      - condition: state
        entity_id: input_select.house_presence
        state: 'Lady and The Tramp'
      - condition: state
        entity_id: input_select.house_presence
        state: 'lady ALONE'
  action:
    service: homeassistant.turn_on
    entity_id: script.timed_lamp_closet_night

## Turn on light when movement closet
- id: turn_on_lights_when_there_is_movement_closet
  alias: Turn on lights when there is movement closet
  trigger:
    - platform: state
      entity_id: !secret coolcam_motion_sensor_5
      from: 'off'
      to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '17:00:00'
      before: '01:30:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_select.house_presence
        state: 'Home'
      - condition: state
        entity_id: input_select.house_presence
        state: 'Lady and The Tramp'
      - condition: state
        entity_id: input_select.house_presence
        state: 'lady ALONE'
  action:
    service: homeassistant.turn_on
    entity_id: script.timed_lamp_closet

## Kareems OUT! Nobody Home, set presence to 'Nobody Home'
- id: nobody_home
  alias: Nobody Home
  trigger:
    - platform: state
      entity_id: group.kareem_status
      to: 'not_home'
    - platform: state
      entity_id: device_tracker.lady_iphone
      to: 'not_home'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: group.kareem_status
      state: 'not_home'
    - condition: state
      entity_id: device_tracker.lady_iphone
      state: 'not_home'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.house_presence
        option: 'Nobody Home'
#    - service: notify.pushbullet
#      data:
#        target: !secret email_target_pushbullet
#        title: 'Nobody Home'
#        message: "Nobody Home!"

## Turn stuff off when nobody is home
- id: kareems_leaving
  alias: Kareems LEAVING
  trigger:
    - platform: state
      entity_id: input_select.house_presence
      to: 'Nobody Home'
      for:
        minutes: 30
  action:
    - service: homeassistant.turn_off
      entity_id:
## Turn off OPTIMUS Triple Screens
        - !secret plug_1
## Turn off bedside Lamp
        - !secret plug_2
## Turn off Bedroom TV + Chromecast
        - !secret plug_3
## Turn off Livingroom TV + Chromecast
        - !secret plug_6
## Turn off lights
        - !secret light_upstairs
        - !secret light_downstairs
        - !secret light_entrance
        - !secret light_spots_1
        - !secret light_table_1
        - !secret light_bedroom_1
        - !secret light_closet
        - !secret light_gameroom_1

## Kareems HOME alone! set presence to 'Home' - DETECT after Home Assistant Startup
- id: kareems_home_alone_detect_after_starup
  alias: Kareems HOME alone DETECT after startup
  trigger:
    - platform: homeassistant
      event: start
  condition:
    condition: state
    entity_id: group.kareem_status
    state: 'home'
  action:
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'Kareems HOME alone'
        message: "Kareems HOME alone! (after startup)"
#    - delay: 0:01
    - service: input_select.select_option
      data:
        entity_id: input_select.house_presence
        option: 'Home'
    - delay: 0:02
    - service: homeassistant.turn_on
      entity_id: 
        - script.timed_lamp_entrance

## Kareems HOME alone! set presence to 'Home'
- id: kareems_home_alone
  alias: Kareems HOME alone
  trigger:
    - platform: state
      entity_id: group.kareem_status
      to: 'home'
#    - platform: state
#      entity_id: device_tracker.lady_iphone
#      to: 'not_home'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: group.kareem_status
      state: 'home'
    - condition: state
      entity_id: device_tracker.lady_iphone
      state: 'not_home'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.house_presence
        option: 'Home'
    - service: homeassistant.turn_on
      entity_id:
        - script.timed_lamp_entrance
#    - service: notify.pushbullet
#      data: 
#        target: !secret email_target_pushbullet
#        title: 'Kareems HOME alone'
#        message: "Kareems HOME alone!"

## Kareems comin' HOME! set presence to 'Warm House'
#- id: kareems_coming_home
#  alias: Kareems coming HOME
#  trigger:
#    - platform: state
#      entity_id: group.kareem_status
#      from: 'not_home'
#      to: 'warm_house'
#  action:
#    - service: input_select.select_option
#      data:
#        entity_id: input_select.house_presence
#        option: 'Warm House'

## Kareems HOME and lady! set presence to 'Lady and The Tramp'.
- id: kareems_home_with_lady
  alias: Kareems HOME with lady
  trigger:
    - platform: state
      entity_id: group.kareem_status
      to: 'home'
    - platform: state
      entity_id: device_tracker.lady_iphone
      to: 'home'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: group.kareem_status
      state: 'home'
    - condition: state
      entity_id: device_tracker.lady_iphone
      state: 'home'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.house_presence
        option: 'Lady and The Tramp'
    - service: homeassistant.turn_on
      entity_id:
        - script.timed_lamp_entrance
#    - service: notify.pushbullet
#      data: 
#        target: !secret email_target_pushbullet
#        title: 'Lady Arrived'
#        message: "Lady Arrived!"

## Lady is HOME ALONE! set presence to 'Lady and The Tramp'.
- id: lady_home_alone
  alias: Lady HOME ALONE
  trigger:
#    - platform: state
#      entity_id: group.kareem_status
#      to: 'not_home'
    - platform: state
      entity_id: device_tracker.lady_iphone
#      from: 'not_home'
      to: 'home'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: group.kareem_status
      state: 'not_home'
    - condition: state
      entity_id: device_tracker.lady_iphone
      state: 'home'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.house_presence
        option: 'lady ALONE'
    - service: notify.pushbullet
      data: 
        target: !secret email_target_pushbullet
        title: 'Lady HOME ALONE'
        message: "Lady HOME ALONE!"

##########################
#### HEATING PRESENCE ####
##########################

## Heating When Waking up, check ever 5 minutes
- id: heating_detect_kareems_home_wakeup
  alias: Heating DETECT Kareems HOME Wakeup
  trigger:
    - platform: time
      at: '06:00:00'
    - platform: time
      # You can also match on interval. This will match every x minutes
      minutes: '/5'
      seconds: 00
    - platform: state
      entity_id: input_select.house_presence
      to: 'Home'
    - platform: state
      entity_id: input_select.house_presence
      to: 'Lady and The Tramp'
    - platform: state
      entity_id: input_select.house_presence
      to: 'lady ALONE'
  condition:
    condition: and
    conditions:
    - condition: time
      after: '06:00:00'
      before: '09:00:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_select.house_presence
        state: 'Home'
      - condition: state
        entity_id: input_select.house_presence
        state: 'Lady and The Tramp'
      - condition: state
        entity_id: input_select.house_presence
        state: 'lady ALONE'
  action:
    - service: climate.set_temperature
      entity_id: climate.house_heating
      data_template:
        temperature: "{{ states('input_number.rest_temp') }}"
#    - service: climate.set_temperature
#      data:
#        entity_id: climate.house_heating
#        temperature: 18
#        operation_mode: Heat
#    - service: notify.pushbullet
#      data: 
#        target: !secret email_target_pushbullet
#        title: 'Heating Waking up'
#        message: "House waking up!"

## Pre-Heat HOME
#- id: heating_detect_kareems_coming_home
#  alias: Heating DETECT Kareems coming HOME
#  trigger:
#    - platform: state
#      entity_id: input_select.house_presence
#      to: 'Warm House'
#  condition:
#    condition: and
#    conditions:
#    - condition: time
#      after: '09:00:00'
#      before: '23:00:00'
#    - condition: state
#      entity_id: input_select.house_presence
#      state: 'Warm House'
#  action:
#    - service: climate.set_temperature
#      entity_id: climate.house_heating
#      data_template:
#        temperature: "{{ states('input_number.rest_temp') }}"

## Heating AT HOME
- id: heating_detect_kareems_arrived
  alias: Heating DETECT Kareems ARRIVED
  trigger:
    - platform: time
      at: '09:00:00'
    - platform: state
      entity_id: input_select.house_presence
      to: 'Home'
    - platform: state
      entity_id: input_select.house_presence
      to: 'Lady and The Tramp'
    - platform: state
      entity_id: input_select.house_presence
      to: 'lady ALONE'
  condition:
    condition: and
    conditions:
    - condition: time
      after: '09:00:00'
      before: '23:00:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_select.house_presence
        state: 'Home'
      - condition: state
        entity_id: input_select.house_presence
        state: 'Lady and The Tramp'
      - condition: state
        entity_id: input_select.house_presence
        state: 'lady ALONE'
  action:
    - service: climate.set_temperature
      entity_id: climate.house_heating
      data_template:
        temperature: "{{ states('input_number.target_temp') }}"
#    - service: climate.set_temperature
#      data:
#        entity_id: climate.house_heating
#        temperature: 20
#        operation_mode: Heat
#    - service: notify.pushbullet
#      data: 
#        target: !secret email_target_pushbullet
#        title: 'Heating ON'
#        message: "House warming for you!"

## Heating When AT HOME, check ever 5 minutes
- id: heating_detect_kareems_home_day
  alias: Heating DETECT Kareems HOME Day
  trigger:
    - platform: time
      at: '09:00:00'
    - platform: time
      # You can also match on interval. This will match every x minutes
      minutes: '/5'
      seconds: 00
    - platform: state
      entity_id: input_select.house_presence
      to: 'Home'
    - platform: state
      entity_id: input_select.house_presence
      to: 'Lady and The Tramp'
    - platform: state
      entity_id: input_select.house_presence
      to: 'lady ALONE'
  condition:
    condition: and
    conditions:
    - condition: time
      after: '09:00:00'
      before: '23:00:00'
    - condition: or
      conditions:
      - condition: state
        entity_id: input_select.house_presence
        state: 'Home'
      - condition: state
        entity_id: input_select.house_presence
        state: 'Lady and The Tramp'
      - condition: state
        entity_id: input_select.house_presence
        state: 'lady ALONE'
  action:
    - service: climate.set_temperature
      entity_id: climate.house_heating
      data_template:
        temperature: "{{ states('input_number.target_temp') }}"
#    - service: climate.set_temperature
#      data:
#        entity_id: climate.house_heating
#        temperature: 20
#        operation_mode: Heat
#    - service: notify.pushbullet
#      data: 
#        target: !secret email_target_pushbullet
#        title: 'Heating STILL ON'
#        message: "House toasty!"

## Heating When Nobody Home
- id: heating_detect_kareems_leaving
  alias: Heating DETECT Kareems LEAVING
  trigger:
    - platform: state
      entity_id: input_select.house_presence
      to: 'Nobody Home'
    - platform: time
      minutes: '/5'
      seconds: 00
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_select.house_presence
      state: 'Nobody Home'
  action:
    - service: climate.set_temperature
      entity_id: climate.house_heating
      data_template:
        temperature: "{{ states('input_number.away_temp') }}"
#    - service: climate.set_temperature
#      data:
#        entity_id: climate.house_heating
#        temperature: 14
#        operation_mode: Heat
#    - service: notify.pushbullet
#      data: 
#        target: !secret email_target_pushbullet
#        title: 'Heating OFF'
#        message: "House cooling!"

##########################
#### HEATING SCHEDULE ####
##########################

## Night Heating
- id: heating_schedule_night
  alias: Heating SCHEDULE Night
  trigger:
    - platform: time
      at: '23:00:00'
  condition:
    condition: and
    conditions:
    - condition: time
      after: '23:00:00'
      before: '06:00:00'
  action:
    - service: climate.set_temperature
      entity_id: climate.house_heating
      data_template:
        temperature: "{{ states('input_number.away_temp') }}"
#    - service: climate.set_temperature
#      data:
#        entity_id: climate.house_heating
#        temperature: 14
#        operation_mode: Heat

################################
#### HEATING MANUAL CONTROL ####
################################

## manual control of heating via slider
- id: heating_slider_moved
  alias: Heating slider moved
  trigger:
    - platform: state
      entity_id: input_number.target_temp
  action:
    - service: climate.set_temperature
      entity_id: climate.house_heating
      data_template:
        temperature: "{{ states('input_number.target_temp') }}"

################################
### VACATION MODE ###
#####################
## https://github.com/ronmarco/home-assistant-config/blob/master/yaml_automation/status-vacation.yaml

## Vacation Mode
# Inspired by geek of week
# https://github.com/geekofweek/homeassistant

# Turn vacation mode on automatically
- id: vacation_mode_on_when_gone_24_hours
  alias: Vacation mode on when gone 24 hours
  trigger:
    - platform: state
      entity_id: group.kareem_status
      from: 'home'
      to: 'not_home'
      for:
        hours: 24
        minutes: 0
        seconds: 0
  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.vacation_mode

# Turn on lights when vacation mode active
- id: vacation_lights_at_sunset_when_vacation_mode_on
  alias: Vacation lights at sunset when vacation mode on
  trigger:
    - platform: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'
  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'
  action:
    - service: script.vacation_lights_init

# Turn vacation mode off automatically
- id: vacation_mode_off_when_home
  alias: Vacation mode off when home
  trigger:
    - platform: state
      entity_id: group.kareem_status
      from: 'not_home'
      to: 'home'
  action:
    - service: homeassistant.turn_off
      entity_id:
        - input_boolean.vacation_mode
        - script.vacation_lights_away_sequence
        - script.vacation_lights_init
